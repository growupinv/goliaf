import{aC as V,ax as G,ay as y,ap as f,d as R,r as C,c as j,g as _,b as h,e as i,w as u,h as d,aB as z,F as x,l as S,f as H,t as g,m as J,s as K,v as p,aD as Z,k as $,Z as q,x as O,z as Q,aJ as W,aK as X,E as Y,_ as ee}from"./index-ff671c6d.js";/* empty css                      *//* empty css             *//* empty css            *//* empty css              */import{N as te}from"./NavBar-fa151205.js";V();const se=G("myLogStore",{state:()=>({logs:[],multipleSelection:[],loading:!0}),actions:{async SetMyLogs(l){const a=y(),t={data:l,user_id:a.user.id,user_tg:a.user.user_tg};return new Promise((o,n)=>{f.post("/setmylogs",{payload:t}).then(s=>{this.logs!==null&&this.logs.push(...s.data.payload),o(s)}).catch(s=>{console.error("Error get myLogs:",s),n(s)})})},async GetMyLogs(l,a){const t=y(),o={data:{page:l,limit:a},user_id:t.user.id,user_tg:t.user.user_tg};return new Promise((n,s)=>{f.post("/mylogs",{payload:o}).then(r=>{r.data.status=="ok"&&(this.logs=r.data.payload),n(r)}).catch(r=>{console.error("Error get myLogs:",r),s(r)})})},async DeleteAllMyLogs(l){const a=y();return l={data:"deleteallmylogs",user_id:a.user.id,user_tg:a.user.user_tg},new Promise((t,o)=>{f.post("/deleteallmylogs",{payload:l}).then(n=>{n.data.status=="ok"&&(this.logs=[]),t(n)}).catch(n=>{console.error("Error delete all myLogs:",n),o(n)})})},async DeleteSelectedMyLogs(l){let a=l.filter(o=>o.id).map(o=>o.id);const t=y();return l={data:a,user_id:t.user.id,user_tg:t.user.user_tg},new Promise((o,n)=>{f.post("/deleteselectedmylogs",{payload:l}).then(s=>{if(s.data.status=="ok"){let r=s.data.payload;this.logs=this.logs.filter(v=>!r.includes(v.id))}o(s)}).catch(s=>{console.error("Error delete all myLogs:",s),n(s)})})}}}),ae={class:"logs-container"},oe={class:"flex items-center space-x-2"},ne={class:"mt-6"},le={class:"date-header"},re={class:"flex justify-between items-center"},ce={class:"text-xs text-gray-400 mt-2"},ie=R({__name:"index",setup(l){const a=se(),t=C(!0),o=C(0),n=j(()=>{const e={};return a.logs.forEach(k=>{const m=new Date(k.created_at).toDateString();e[m]||(e[m]=[]),e[m].push(k)}),e}),s=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),r=e=>new Date(e).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),v=()=>{console.log("Filter clicked")},L=()=>{a.GetMyLogs().then(e=>{e.data.status==="ok"&&a.logs&&a.logs.length>0||p({type:"info",message:"Нет данных для отображения"}),t.value=!1}).catch(e=>{p({type:"error",message:"Произошла ошибка при загрузке логов"}),console.error("Error:",e),t.value=!1})},T=()=>{Z.confirm("Вы уверены, что хотите очистить все логи? Это действие нельзя отменить.","Подтверждение",{confirmButtonText:"Да, очистить",cancelButtonText:"Отмена",type:"warning"}).then(()=>{w()}).catch(()=>{p({type:"info",message:"Очистка логов отменена"})})},w=()=>{t.value=!0,a.DeleteAllMyLogs().then(e=>{e.data.status==="ok"&&(p({type:"success",message:"Логи успешно очищены"}),L())}).catch(e=>{p({type:"error",message:`Ошибка при очистке логов: ${e}`})}).finally(()=>{t.value=!1})},D=e=>e==="ok"?"success":"danger",B=e=>e==="ok"?"#67C23A":"#F56C6C",b=e=>e==="ok"?"success":"danger";return L(),(e,k)=>{const m=$,M=q,F=O,I=Q,N=W,P=X,A=Y;return _(),h("div",ae,[i(te,{title:"История операций"},{right:u(()=>[d("div",oe,[i(M,{value:o.value,class:"item",hidden:o.value===0},{default:u(()=>[i(m,{onClick:v,icon:"Filter"})]),_:1},8,["value","hidden"]),i(m,{onClick:T,icon:"Delete"})])]),_:1}),i(A,{loading:t.value,throttle:800,rows:5,animated:"",class:"m-2"},z({_:2},[t.value?void 0:{name:"default",fn:u(()=>[d("div",ne,[i(P,null,{default:u(()=>[(_(!0),h(x,null,S(H(n),(U,E)=>(_(),h(x,{key:E},[d("div",le,g(s(E)),1),(_(!0),h(x,null,S(U,c=>(_(),J(N,{key:c.id,type:D(c.status),color:B(c.status)},{default:u(()=>[i(I,{class:"mb-4 log-card"},{header:u(()=>[d("div",re,[d("span",null,g(c.event_name),1),i(F,{type:b(c.status)},{default:u(()=>[K(g(c.status),1)]),_:2},1032,["type"])])]),default:u(()=>[d("p",null,g(c.message||"Нет дополнительной информации"),1),d("div",ce,g(r(c.created_at)),1)]),_:2},1024)]),_:2},1032,["type","color"]))),128))],64))),128))]),_:1})])]),key:"0"}]),1032,["loading"])])}}});const ye=ee(ie,[["__scopeId","data-v-4a8f8bcb"]]);export{ye as default};
