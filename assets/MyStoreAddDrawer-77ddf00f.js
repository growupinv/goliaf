import{_ as K,u as O,r as E,G as P,H as w,g as T,b,e as o,w as t,h as r,s as p,f as I,F as S,l as W,t as D,q as j,i as J,J as Q,K as X,L as Y,x as Z,M as ee,k as oe,N as te,O as ne,A as le,B as se}from"./index-ff671c6d.js";/* empty css               *//* empty css                  *//* empty css            *//* empty css              *//* empty css                *//* empty css               */import{u as ae}from"./useValidateToken-f048730e.js";import{tokenDescriptions as F}from"./token-descriptions-1961fc49.js";const L=m=>(le("data-v-553e0a0d"),m=m(),se(),m),re=L(()=>r("span",null,"Добавление магазина",-1)),ie={class:"token-requirements"},de=L(()=>r("p",null,"Требования к API токену:",-1)),ue={class:"token-scopes"},pe={key:0,class:"token-info"},me={style:{color:"#2e865f","font-size":"12px"}},_e={class:"dialog-footer"},ce=["innerHTML"],fe={class:"dialog-footer"},ge={__name:"MyStoreAddDrawer",props:{isVisible:{type:Boolean,required:!0}},emits:["update:isVisible"],setup(m,{emit:h}){const x=O(),k=E(null),f=E(!1),i=P({store_name:"",api_token:""}),a=E(null),C=["Контент","Маркетплейс","Цены и скидки","Аналитика","Рекомендации","Статистика","Продвижение"],z={store_name:[{required:!0,message:"Введите имя магазина",trigger:"blur"}],api_token:[{required:!0,message:"Введите API Token",trigger:"blur"},{validator:N,trigger:"blur"}]},A=l=>{if(!a.value||!a.value.scopes)return"info";const e=l.toLowerCase();return a.value.scopes.some(s=>s.toLowerCase().includes(e))?"success":"danger"};async function N(l,e,s){if(!e){d(),s();return}const{validateToken:u,isValid:_,scopes:g,tokentimeEnd:v,missingTypes:c}=await ae(e,C,"ru");try{await u(),a.value={isValid:_.value,scopes:g.value,tokentimeEnd:v.value},_.value?c.value.length>0?s(new Error(`Недостаточно прав. Отсутствуют: ${c.value.join(", ")}`)):s():s(new Error("Неверный токен"))}catch(y){console.error("Error during token validation:",y),d(),s(new Error("Ошибка при валидации токена"))}}const q=l=>{l?l.length>=50&&(d(),N(null,l,s=>{s&&console.error(s.message)})):d()},d=()=>{a.value=null},B=l=>{l.validate(async e=>{e?a.value&&a.value.isValid?(console.log("Токен валиден и имеет все необходимые права"),x.SetMyStores(i),M()):console.log("Ошибка отправки формы: токен невалиден или отсутствуют необходимые права"):console.log("Ошибка отправки формы")})},U=l=>{l.resetFields(),d()},M=()=>{h("update:isVisible",!1)};return(l,e)=>{const s=w("InfoFilled"),u=J,_=w("Warning"),g=Q,v=X,c=Y,y=Z,$=ee,V=oe,H=w("Upload"),R=te,G=ne;return T(),b(S,null,[o(R,{"model-value":m.isVisible,direction:"btt",size:"100%",onClose:M,"onUpdate:modelValue":e[5]||(e[5]=n=>l.$emit("update:isVisible",n))},{header:t(()=>[re,o(u,{onClick:e[0]||(e[0]=n=>f.value=!0),size:"32",color:"warning"},{default:t(()=>[o(s)]),_:1})]),footer:t(()=>[r("span",_e,[o(V,{onClick:e[3]||(e[3]=n=>U(k.value))},{default:t(()=>[p("Reset")]),_:1}),o(V,{type:"primary",onClick:e[4]||(e[4]=n=>B(k.value)),loading:I(x).loading},{default:t(()=>[p(" Сохранить "),o(u,{class:"el-icon--right"},{default:t(()=>[o(H)]),_:1})]),_:1},8,["loading"])])]),default:t(()=>[o($,{model:i,ref_key:"formRef",ref:k,rules:z,"label-position":"top"},{default:t(()=>[o(c,{prop:"store_name"},{label:t(()=>[p(" Имя магазина "),o(g,{effect:"dark",content:"Название необходимо для магазина",placement:"bottom"},{default:t(()=>[o(u,{style:{"margin-left":"4px"},size:12},{default:t(()=>[o(_)]),_:1})]),_:1})]),default:t(()=>[o(v,{modelValue:i.store_name,"onUpdate:modelValue":e[1]||(e[1]=n=>i.store_name=n),clearable:"",autocomplete:"off",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(c,{prop:"api_token"},{label:t(()=>[p(" API Token "),o(g,{"raw-content":"",effect:"dark",content:I(F).contentToken.content,placement:"bottom"},{default:t(()=>[o(u,{style:{"margin-left":"4px"},size:12},{default:t(()=>[o(_)]),_:1})]),_:1},8,["content"])]),default:t(()=>[o(v,{modelValue:i.api_token,"onUpdate:modelValue":e[2]||(e[2]=n=>i.api_token=n),clearable:"",autocomplete:"off",style:{width:"100%"},onInput:q,onClear:d},null,8,["modelValue"]),r("div",ie,[de,r("div",ue,[(T(),b(S,null,W(C,n=>o(y,{key:n,type:A(n),effect:"plain",class:"mx-1",size:"small"},{default:t(()=>[p(D(n),1)]),_:2},1032,["type"])),64))])]),a.value&&a.value.tokentimeEnd?(T(),b("div",pe,[r("p",me," Годен до: "+D(a.value.tokentimeEnd),1)])):j("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value"]),o(G,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=n=>f.value=n),title:"Памятка",width:"500","align-center":""},{footer:t(()=>[r("div",fe,[o(V,{type:"primary",onClick:e[6]||(e[6]=n=>f.value=!1)},{default:t(()=>[p(" Понятно ")]),_:1})])]),default:t(()=>[r("div",{innerHTML:I(F).headline_content,style:{"text-align":"left"}},null,8,ce)]),_:1},8,["modelValue"])],64)}}},xe=K(ge,[["__scopeId","data-v-553e0a0d"]]);export{xe as default};
