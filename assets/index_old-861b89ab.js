import{H as Z,al as J,d as P,aE as F,a4 as B,aV as Q,aW as ee,aX as te,aY as ne,aZ as oe,a_ as ie,r as b,c as V,a$ as re,g as C,b as k,e as d,w as p,h as x,f as u,i as v,j as se,k as w,p as ae,b0 as le,z as ce,ac as A,ah as de,t as L,m as ue,aA as me,P as $,b1 as pe,b2 as ge,b3 as fe,_ as he}from"./index-ff671c6d.js";import{N as _e}from"./NavBar-fa151205.js";import ye from"./ActionsDrawer-49c01f12.js";import{S as be}from"./sortable.esm-96be61dc.js";function E(e){e.parentElement!==null&&e.parentElement.removeChild(e)}function T(e,t,n){const o=n===0?e.children[0]:e.children[n-1].nextSibling;e.insertBefore(t,o)}function xe(){return typeof window<"u"?window.console:global.console}const ve=xe();function Ce(e){const t=Object.create(null);return function(o){return t[o]||(t[o]=e(o))}}const we=/-(\w)/g,Ee=Ce(e=>e.replace(we,(t,n)=>n.toUpperCase())),N=["Start","Add","Remove","Update","End"],R=["Choose","Unchoose","Sort","Filter","Clone"],j=["Move"],Ie=[j,N,R].flatMap(e=>e).map(e=>`on${e}`),D={manage:j,manageAndEmit:N,emit:R};function De(e){return Ie.indexOf(e)!==-1}const Se=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function Fe(e){return Se.includes(e)}function Ve(e){return["transition-group","TransitionGroup"].includes(e)}function M(e){return["id","class","role","style"].includes(e)||e.startsWith("data-")||e.startsWith("aria-")||e.startsWith("on")}function z(e){return e.reduce((t,[n,o])=>(t[n]=o,t),{})}function ke({$attrs:e,componentData:t={}}){return{...z(Object.entries(e).filter(([o,i])=>M(o))),...t}}function Ae({$attrs:e,callBackBuilder:t}){const n=z(q(e));Object.entries(t).forEach(([i,r])=>{D[i].forEach(a=>{n[`on${a}`]=r(a)})});const o=`[data-draggable]${n.draggable||""}`;return{...n,draggable:o}}function q(e){return Object.entries(e).filter(([t,n])=>!M(t)).map(([t,n])=>[Ee(t),n]).filter(([t,n])=>!De(t))}const U=({el:e})=>e,Le=(e,t)=>e.__draggable_context=t,O=e=>e.__draggable_context;class $e{constructor({nodes:{header:t,default:n,footer:o},root:i,realList:r}){this.defaultNodes=n,this.children=[...t,...n,...o],this.externalComponent=i.externalComponent,this.rootTransition=i.transition,this.tag=i.tag,this.realList=r}get _isRootComponent(){return this.externalComponent||this.rootTransition}render(t,n){const{tag:o,children:i,_isRootComponent:r}=this;return t(o,n,r?{default:()=>i}:i)}updated(){const{defaultNodes:t,realList:n}=this;t.forEach((o,i)=>{Le(U(o),{element:n[i],index:i})})}getUnderlyingVm(t){return O(t)}getVmIndexFromDomIndex(t,n){const{defaultNodes:o}=this,{length:i}=o,r=n.children,a=r.item(t);if(a===null)return i;const m=O(a);if(m)return m.index;if(i===0)return 0;const g=U(o[0]),y=[...r].findIndex(f=>f===g);return t<y?0:i}}function Te(e,t){const n=e[t];return n?n():[]}function Ue({$slots:e,realList:t,getKey:n}){const o=t||[],[i,r]=["header","footer"].map(g=>Te(e,g)),{item:a}=e;if(!a)throw new Error("draggable element must have an item slot");const m=o.flatMap((g,y)=>a({element:g,index:y}).map(f=>(f.key=n(g),f.props={...f.props||{},"data-draggable":!0},f)));if(m.length!==o.length)throw new Error("Item slot must have only one child");return{header:i,footer:r,default:m}}function Oe(e){const t=Ve(e),n=!Fe(e)&&!t;return{transition:t,externalComponent:n,tag:n?Z(e):t?J:e}}function Pe({$slots:e,tag:t,realList:n,getKey:o}){const i=Ue({$slots:e,realList:n,getKey:o}),r=Oe(t);return new $e({nodes:i,root:r,realList:n})}function H(e,t){B(()=>this.$emit(e.toLowerCase(),t))}function K(e){return(t,n)=>{if(this.realList!==null)return this[`onDrag${e}`](t,n)}}function Be(e){const t=K.call(this,e);return(n,o)=>{t.call(this,n,o),H.call(this,e,n)}}let I=null;const Ne={list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:e=>e},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},Re=["update:modelValue","change",...[...D.manageAndEmit,...D.emit].map(e=>e.toLowerCase())],je=P({name:"draggable",inheritAttrs:!1,props:Ne,emits:Re,data(){return{error:!1}},render(){try{this.error=!1;const{$slots:e,$attrs:t,tag:n,componentData:o,realList:i,getKey:r}=this,a=Pe({$slots:e,tag:n,realList:i,getKey:r});this.componentStructure=a;const m=ke({$attrs:t,componentData:o});return a.render(F,m)}catch(e){return this.error=!0,F("pre",{style:{color:"red"}},e.stack)}},created(){this.list!==null&&this.modelValue!==null&&ve.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted(){if(this.error)return;const{$attrs:e,$el:t,componentStructure:n}=this;n.updated();const o=Ae({$attrs:e,callBackBuilder:{manageAndEmit:r=>Be.call(this,r),emit:r=>H.bind(this,r),manage:r=>K.call(this,r)}}),i=t.nodeType===1?t:t.parentElement;this._sortable=new be(i,o),this.targetDomElement=i,i.__draggable_component__=this},updated(){this.componentStructure.updated()},beforeUnmount(){this._sortable!==void 0&&this._sortable.destroy()},computed:{realList(){const{list:e}=this;return e||this.modelValue},getKey(){const{itemKey:e}=this;return typeof e=="function"?e:t=>t[e]}},watch:{$attrs:{handler(e){const{_sortable:t}=this;t&&q(e).forEach(([n,o])=>{t.option(n,o)})},deep:!0}},methods:{getUnderlyingVm(e){return this.componentStructure.getUnderlyingVm(e)||null},getUnderlyingPotencialDraggableComponent(e){return e.__draggable_component__},emitChanges(e){B(()=>this.$emit("change",e))},alterList(e){if(this.list){e(this.list);return}const t=[...this.modelValue];e(t),this.$emit("update:modelValue",t)},spliceList(){const e=t=>t.splice(...arguments);this.alterList(e)},updatePosition(e,t){const n=o=>o.splice(t,0,o.splice(e,1)[0]);this.alterList(n)},getRelatedContextFromMoveEvent({to:e,related:t}){const n=this.getUnderlyingPotencialDraggableComponent(e);if(!n)return{component:n};const o=n.realList,i={list:o,component:n};return e!==t&&o?{...n.getUnderlyingVm(t)||{},...i}:i},getVmIndexFromDomIndex(e){return this.componentStructure.getVmIndexFromDomIndex(e,this.targetDomElement)},onDragStart(e){this.context=this.getUnderlyingVm(e.item),e.item._underlying_vm_=this.clone(this.context.element),I=e.item},onDragAdd(e){const t=e.item._underlying_vm_;if(t===void 0)return;E(e.item);const n=this.getVmIndexFromDomIndex(e.newIndex);this.spliceList(n,0,t);const o={element:t,newIndex:n};this.emitChanges({added:o})},onDragRemove(e){if(T(this.$el,e.item,e.oldIndex),e.pullMode==="clone"){E(e.clone);return}const{index:t,element:n}=this.context;this.spliceList(t,1);const o={element:n,oldIndex:t};this.emitChanges({removed:o})},onDragUpdate(e){E(e.item),T(e.from,e.item,e.oldIndex);const t=this.context.index,n=this.getVmIndexFromDomIndex(e.newIndex);this.updatePosition(t,n);const o={element:this.context.element,oldIndex:t,newIndex:n};this.emitChanges({moved:o})},computeFutureIndex(e,t){if(!e.element)return 0;const n=[...t.to.children].filter(a=>a.style.display!=="none"),o=n.indexOf(t.related),i=e.component.getVmIndexFromDomIndex(o);return n.indexOf(I)!==-1||!t.willInsertAfter?i:i+1},onDragMove(e,t){const{move:n,realList:o}=this;if(!n||!o)return!0;const i=this.getRelatedContextFromMoveEvent(e),r=this.computeFutureIndex(i,e),a={...this.context,futureIndex:r},m={...e,relatedContext:i,draggedContext:a};return n(m,t)},onDragEnd(){I=null}}}),Me=je,ze={class:"automation-container"},qe={class:"flex items-center space-x-2"},He={class:"step-content"},Ke={class:"step-number"},We={class:"step-title"},Ge=P({__name:"index_old",setup(e){const t=Q({Upload:ee,Timer:te,PriceTag:ne,Bell:oe,Document:ie}),n=b([{id:1,title:"Загрузить карточку товара",type:"upload",icon:"Upload",color:"#409EFF",swiped:!1},{id:2,title:"Ожидание: 10 минут",type:"wait",icon:"Timer",color:"#67C23A",swiped:!1},{id:3,title:"Поднять цены (23:10)",type:"price_up",icon:"PriceTag",color:"#E6A23C",swiped:!1},{id:4,title:"Опустить цены (07:20)",type:"price_down",icon:"PriceTag",color:"#F56C6C",swiped:!1}]),o=b(!1),i=b(!1),r=b(null),a=b([{title:"Загрузить карточки",type:"upload",category:"Товары",icon:"Upload",color:"#409EFF"},{title:"Обновить остатки",type:"update_stock",category:"Товары",icon:"Document",color:"#409EFF"},{title:"Рекомендации",type:"recomendation",category:"Товары",icon:"Document",color:"#409EFF"},{title:"Ожидание",type:"wait",category:"Время",icon:"Timer",color:"#67C23A"},{title:"Планировщик",type:"schedule",category:"Время",icon:"Timer",color:"#67C23A"},{title:"Поднять цены",type:"price_up",category:"Цены",icon:"PriceTag",color:"#E6A23C"},{title:"Опустить цены",type:"price_down",category:"Цены",icon:"PriceTag",color:"#F56C6C"},{title:"Отправить уведомление",type:"notify",category:"Прочее",icon:"Bell",color:"#909399"},{title:"Выполнить скрипт",type:"script",category:"Прочее",icon:"Document",color:"#909399"}]),m=l=>{n.value.push({id:n.value.length+1,title:l.title,type:l.type,icon:l.icon,color:l.color,swiped:!1})},g=l=>{const c=n.value.findIndex(h=>h.id===l);c!==-1&&n.value.splice(c,1)},y=l=>{console.log("Редактирование шага:",l)},f=l=>{i.value=!0,r.value=l.oldIndex,n.value.forEach(c=>c.swiped=!1)},W=()=>{i.value=!1,r.value=null},G=l=>i.value&&r.value!==l,X=V(()=>l=>t[l]),S=(l,c)=>{const h=n.value.findIndex(s=>s.id===l);h!==-1&&(c==="left"?n.value[h].swiped=!0:c==="right"&&(n.value[h].swiped=!1))},Y=V(()=>({animation:200,disabled:!1,ghostClass:"ghost",delayOnTouchOnly:!0,delay:300,touchStartThreshold:5}));return(l,c)=>{const h=re("touch");return C(),k("div",ze,[d(_e,{title:"Автоматизация"},{right:p(()=>[x("div",qe,[d(u(v),{onClick:c[0]||(c[0]=()=>{}),size:"32",color:"warning"},{default:p(()=>[d(u(se))]),_:1}),d(u(w),{type:"primary",onClick:c[1]||(c[1]=s=>o.value=!0)},{default:p(()=>[d(u(v),null,{default:p(()=>[d(u(ae))]),_:1})]),_:1})])]),_:1}),d(u(Me),fe({modelValue:n.value,"onUpdate:modelValue":c[2]||(c[2]=s=>n.value=s),"item-key":"id",class:"funnel-steps mt-4"},u(Y),{onStart:f,onEnd:W}),{item:p(({element:s})=>[le((C(),k("div",{key:s.id,class:"swipe-container"},[d(u(ce),{class:A(["funnel-step",{dragging:i.value&&r.value===n.value.findIndex(_=>_.id===s.id),"drag-over":G(n.value.findIndex(_=>_.id===s.id)),swiped:s.swiped}]),style:de({borderLeft:`8px solid ${s.color}`})},{default:p(()=>[x("div",He,[x("span",Ke,L(n.value.findIndex(_=>_.id===s.id)+1),1),d(u(v),{size:24,color:s.color},{default:p(()=>[(C(),ue(me(u(X)(s.icon))))]),_:2},1032,["color"]),x("span",We,L(s.title),1)])]),_:2},1032,["class","style"]),x("div",{class:A(["swipe-actions",{visible:s.swiped}])},[d(u(w),{class:"edit-button",type:"primary",onClick:$(_=>y(s.id),["stop"])},{default:p(()=>[d(u(v),null,{default:p(()=>[d(u(pe))]),_:1})]),_:2},1032,["onClick"]),d(u(w),{class:"delete-button",type:"danger",onClick:$(_=>g(s.id),["stop"])},{default:p(()=>[d(u(v),null,{default:p(()=>[d(u(ge))]),_:1})]),_:2},1032,["onClick"])],2)])),[[h,()=>S(s.id,"left"),"swipe",{left:!0}],[h,()=>S(s.id,"right"),"swipe",{right:!0}]])]),_:1},16,["modelValue"]),d(ye,{visible:o.value,"onUpdate:visible":c[3]||(c[3]=s=>o.value=s),"available-actions":a.value,onSelect:m},null,8,["visible","available-actions"])])}}});const Qe=he(Ge,[["__scopeId","data-v-a6fcc6b1"]]);export{Qe as default};
