import{r as a}from"./index-ff671c6d.js";class d extends Error{}d.prototype.name="InvalidTokenError";function b(n){return decodeURIComponent(atob(n).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function g(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return b(e)}catch{return atob(e)}}function S(n,e){if(typeof n!="string")throw new d("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,o=n.split(".")[t];if(typeof o!="string")throw new d(`Invalid token specified: missing part #${t+1}`);let i;try{i=g(o)}catch(s){throw new d(`Invalid token specified: invalid base64 for part #${t+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new d(`Invalid token specified: invalid json for part #${t+1} (${s.message})`)}}const r={testContour:{ru:"Тестовый контур",en:"Test contour"},content:{ru:"Контент",en:"Content"},analytics:{ru:"Аналитика",en:"Analytics"},pricesDiscounts:{ru:"Цены и скидки",en:"Prices and discounts"},marketplace:{ru:"Маркетплейс",en:"Marketplace"},statistics:{ru:"Статистика",en:"Statistics"},promotion:{ru:"Продвижение",en:"Promotion"},questionsFeedbacks:{ru:"Вопросы и отзывы",en:"Questions and feedbacks"},chat:{ru:"Чат с покупателями",en:"Buyers chat"},supplies:{ru:"Поставки",en:"Supplies"},returns:{ru:"Возвраты",en:"Returns"},recommendations:{ru:"Рекомендации",en:"Recommendations"},tokenReadOnly:{ru:"Токен только на чтение",en:"Token with read only access"},tokenReadWrite:{ru:"Токен на чтение и запись",en:"Token with read and write access"}};async function I(n,e,t){const o=a(!1),i=a(null),s=a(null),c=a([]),f=a([]),p=a(""),u=a("");async function v(){try{const l=S(n);o.value=!0,i.value=null,s.value=l;const h=JSON.parse(JSON.stringify(l)),m=D(h.s,t);c.value=[...m],f.value=e.filter(w=>!c.value.some(y=>y.toLowerCase()===w.toLowerCase())),u.value=T(h.exp);const k=new Date(u.value);if(u.value=`${k.toLocaleDateString()} ${k.toLocaleTimeString()}`,u.value==="")throw new Error("Invalid token specified: impossible to determine the lifetime of the token");p.value=c.value[c.value.length-1]}catch(l){console.error("Validation error:",l.message),o.value=!1,i.value=l.message,s.value=null,c.value=[],p.value=""}}return{isValid:o,missingTypes:f,tokentimeEnd:u,error:i,decodedToken:s,scopes:c,tokenReadWrite:p,validateToken:v}}function T(n){return n==null?"":new Date(n*1e3).toString()}function D(n,e){let t=[];return n===0&&t.push(r.testContour[e]),(n>>1)%2!==0&&t.push(r.content[e]),(n>>2)%2!==0&&t.push(r.analytics[e]),(n>>3)%2!==0&&t.push(r.pricesDiscounts[e]),(n>>4)%2!==0&&t.push(r.marketplace[e]),(n>>5)%2!==0&&t.push(r.statistics[e]),(n>>6)%2!==0&&t.push(r.promotion[e]),(n>>7)%2!==0&&t.push(r.questionsFeedbacks[e]),(n>>8)%2!==0&&t.push(r.recommendations[e]),(n>>9)%2!==0&&t.push(r.chat[e]),(n>>10)%2!==0&&t.push(r.supplies[e]),(n>>11)%2!==0&&t.push(r.returns[e]),t.length===0||((n>>30)%2!==0?t.push(r.tokenReadOnly[e]):t.push(r.tokenReadWrite[e])),t}export{I as u};
